<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸª´ Zen Garden - Guerrilla Calm</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #0d1108;
      color: #aaff00;
      font-family: monospace;
      overflow: hidden;
      touch-action: none;
    }
    #container {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 10px;
      box-sizing: border-box;
    }
    h1 {
      margin: 0.4em 0 0.2em;
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      text-shadow: 0 0 10px #aaff00;
    }
    #instructions {
      margin: 0.3em 0 1em;
      font-size: clamp(0.9rem, 3.5vw, 1.1rem);
      opacity: 0.85;
      text-align: center;
    }
    #canvas-wrapper {
      width: 100%;
      max-width: 90vmin;
      aspect-ratio: 1 / 1;
      margin: 0 auto;
      position: relative;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      border: 3px solid #8B4513;
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(139,69,19,0.4);
      touch-action: none;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="none" stroke="%23aaff00" stroke-width="4"/><line x1="8" y1="8" x2="24" y2="24" stroke="%23aaff00" stroke-width="6"/></svg>') 16 16, auto;
    }
    #ui {
      width: 90%;
      max-width: 600px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1em;
      font-size: clamp(1.1rem, 4vw, 1.4rem);
    }
    #rake-mode {
      display: flex;
      gap: 12px;
    }
    .mode-btn {
      padding: 6px 14px;
      background: rgba(139,69,19,0.4);
      border: 2px solid #8B4513;
      color: #aaff00;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .mode-btn.active {
      background: rgba(139,69,19,0.8);
      border-color: #aaff00;
    }
    #pause-btn, #reset-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(139,69,19,0.3);
      border: 3px solid #8B4513;
      color: #aaff00;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
    }
    #pause-btn { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); }
    #reset-btn  { position: absolute; top: 20px; right: 20px; }

    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.75);
      padding: 2em 3em;
      border: 3px solid #8B4513;
      border-radius: 12px;
      text-align: center;
      color: #aaff00;
      font-size: clamp(1.6rem, 6vw, 2.8rem);
      text-shadow: 0 0 12px #aaff00;
      display: none;
      z-index: 100;
      pointer-events: none;
    }
    #version {
      position: fixed;
      bottom: 10px;
      right: 14px;
      font-size: 0.78rem;
      color: #555;
      opacity: 0.65;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>ğŸª´ Zen Garden</h1>
    <p id="instructions">Drag to rake â€¢ Change style with buttons</p>
    <div id="canvas-wrapper">
      <canvas id="garden"></canvas>
      <div id="message">Garden in Harmony ğŸŒ¿</div>
    </div>
    <div id="ui">
      <div id="score">Time: <span id="time">0</span>s</div>
      <div id="rake-mode">
        <button class="mode-btn active" data-mode="straight">Straight</button>
        <button class="mode-btn" data-mode="wavy">Wavy</button>
        <button class="mode-btn" data-mode="circle">Circle</button>
      </div>
    </div>
    <button id="pause-btn">â¸ï¸</button>
    <button id="reset-btn">Reset</button>
  </div>

  <div id="version">v1.1 â€“ Wind & Modes</div>

  <script>
    const canvas = document.getElementById('garden');
    const ctx = canvas.getContext('2d');
    const timeEl = document.getElementById('time');
    const messageEl = document.getElementById('message');
    const pauseBtn = document.getElementById('pause-btn');
    const resetBtn = document.getElementById('reset-btn');

    let width, height, cellSize;
    let sand = [];
    let rakePath = [];
    let isDrawing = false;
    let startTime = 0;
    let pausedTime = 0;
    let paused = false;
    let gameRunning = false;
    let particles = [];

    let currentMode = 'straight'; // straight | wavy | circle

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Init & Resize
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function resize() {
      const wrapper = document.getElementById('canvas-wrapper');
      width = wrapper.clientWidth;
      height = wrapper.clientHeight;
      canvas.width = width;
      canvas.height = height;
      cellSize = Math.min(width, height) / 40;

      initSand();
      initParticles();
      drawGarden();
    }

    window.addEventListener('resize', resize);

    function initSand() {
      sand = [];
      const cols = Math.floor(width / cellSize) + 2;
      const rows = Math.floor(height / cellSize) + 2;
      for (let y = 0; y < rows; y++) {
        sand[y] = [];
        for (let x = 0; x < cols; x++) {
          sand[y][x] = { ripple: 0 };
        }
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Gentle wind + sand particles
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function initParticles() {
      particles = [];
      for (let i = 0; i < 60; i++) {
        particles.push({
          x: Math.random() * width,
          y: Math.random() * height,
          size: 1 + Math.random() * 2.5,
          speed: 0.2 + Math.random() * 0.6,
          alpha: 0.3 + Math.random() * 0.4
        });
      }
    }

    function updateParticles(delta) {
      particles.forEach(p => {
        p.x += p.speed * delta * 0.06; // gentle rightward wind
        if (p.x > width) {
          p.x = -p.size * 2;
          p.y = Math.random() * height;
        }
      });
    }

    function drawParticles() {
      ctx.fillStyle = 'rgba(245,230,200,0.6)';
      particles.forEach(p => {
        ctx.globalAlpha = p.alpha;
        ctx.fillRect(p.x, p.y, p.size, p.size * 0.2);
      });
      ctx.globalAlpha = 1;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Draw Garden
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function drawGarden() {
      // Base sand
      ctx.fillStyle = '#f5e8c7';
      ctx.fillRect(0, 0, width, height);

      // Sand ripples
      ctx.strokeStyle = 'rgba(210,180,140,0.25)';
      ctx.lineWidth = cellSize * 0.4;
      for (let y = 0; y < sand.length; y++) {
        for (let x = 0; x < sand[y].length; x++) {
          const s = sand[y][x];
          if (s.ripple > 0) {
            ctx.globalAlpha = s.ripple * 0.5;
            ctx.beginPath();
            ctx.arc(x * cellSize, y * cellSize, cellSize * s.ripple * 1.8, 0, Math.PI * 2);
            ctx.stroke();
            s.ripple -= 0.015;
          }
        }
      }
      ctx.globalAlpha = 1;

      // Rake lines
      if (rakePath.length > 1) {
        ctx.strokeStyle = '#d2b48c';
        ctx.lineWidth = cellSize * 0.9;
        ctx.lineCap = 'round';
        ctx.shadowBlur = 6;
        ctx.shadowColor = 'rgba(0,0,0,0.35)';
        ctx.beginPath();

        if (currentMode === 'straight') {
          ctx.moveTo(rakePath[0].x, rakePath[0].y);
          ctx.lineTo(rakePath[rakePath.length-1].x, rakePath[rakePath.length-1].y);
        } else if (currentMode === 'wavy') {
          ctx.moveTo(rakePath[0].x, rakePath[0].y);
          for (let i = 1; i < rakePath.length; i++) {
            const prev = rakePath[i-1];
            const curr = rakePath[i];
            const midX = (prev.x + curr.x) / 2;
            const midY = (prev.y + curr.y) / 2 + Math.sin(i * 0.7) * 12;
            ctx.quadraticCurveTo(midX, midY, curr.x, curr.y);
          }
        } else if (currentMode === 'circle') {
          const centerX = rakePath.reduce((sum, p) => sum + p.x, 0) / rakePath.length;
          const centerY = rakePath.reduce((sum, p) => sum + p.y, 0) / rakePath.length;
          const radius = Math.hypot(rakePath[0].x - centerX, rakePath[0].y - centerY);
          ctx.arc(centerX, centerY, radius * 0.8 + Math.sin(Date.now()*0.004)*10, 0, Math.PI*2);
        }

        ctx.stroke();
        ctx.shadowBlur = 0;
      }

      drawParticles();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Input
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function startRake(e) {
      e.preventDefault();
      isDrawing = true;
      const pos = getPos(e);
      rakePath = [pos];
      addRipple(pos.x, pos.y);
      playRakeSound();
    }

    function moveRake(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const pos = getPos(e);
      rakePath.push(pos);
      addRipple(pos.x, pos.y);
      playRakeSound();
      drawGarden();
    }

    function endRake() {
      isDrawing = false;
      stopRakeSound();
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      return {
        x: clientX - rect.left,
        y: clientY - rect.top
      };
    }

    function addRipple(x, y) {
      const col = Math.floor(x / cellSize);
      const row = Math.floor(y / cellSize);
      if (sand[row]?.[col]) {
        sand[row][col].ripple = 1;
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Rake sound (low hum, pitch varies slightly with speed)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let audioCtx = null;
    let rakeOsc = null;
    let rakeGain = null;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playRakeSound() {
      initAudio();
      if (!rakeOsc) {
        rakeOsc = audioCtx.createOscillator();
        rakeGain = audioCtx.createGain();
        rakeOsc.connect(rakeGain);
        rakeGain.connect(audioCtx.destination);
        rakeOsc.type = 'sine';
        rakeOsc.frequency.setValueAtTime(80, audioCtx.currentTime);
        rakeGain.gain.setValueAtTime(0.0, audioCtx.currentTime);
        rakeOsc.start();
      }
      // Gentle volume & pitch variation
      const vol = 0.08 + Math.random() * 0.06;
      rakeGain.gain.setTargetAtTime(vol, audioCtx.currentTime, 0.05);
      rakeOsc.frequency.setTargetAtTime(75 + Math.random() * 20, audioCtx.currentTime, 0.08);
    }

    function stopRakeSound() {
      if (rakeGain) {
        rakeGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.12);
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Game Loop
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let lastTime = 0;
    function loop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const delta = timestamp - lastTime;
      lastTime = timestamp;

      if (gameRunning && !paused) {
        const elapsed = Math.floor((timestamp - startTime - pausedTime) / 1000);
        timeEl.textContent = elapsed;

        // Win condition: 5 minutes = 300 seconds
        if (elapsed >= 300 && messageEl.style.display !== 'block') {
          messageEl.style.display = 'block';
        }

        updateParticles(delta);
      }

      drawGarden();
      requestAnimationFrame(loop);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Controls
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    canvas.addEventListener('mousedown', startRake);
    canvas.addEventListener('mousemove', moveRake);
    canvas.addEventListener('mouseup', endRake);
    canvas.addEventListener('mouseleave', endRake);

    canvas.addEventListener('touchstart', startRake);
    canvas.addEventListener('touchmove', moveRake);
    canvas.addEventListener('touchend', endRake);
    canvas.addEventListener('touchcancel', endRake);

    // Rake mode buttons
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;
      });
    });

    pauseBtn.addEventListener('click', () => {
      paused = !paused;
      if (paused) {
        pausedTime += performance.now() - startTime;
        stopRakeSound();
      } else {
        startTime = performance.now() - pausedTime;
      }
    });

    resetBtn.addEventListener('click', () => {
      rakePath = [];
      initSand();
      initParticles();
      startTime = performance.now();
      pausedTime = 0;
      paused = false;
      messageEl.style.display = 'none';
      drawGarden();
    });

    // Start on first interaction
    document.addEventListener('click', () => {
      if (!gameRunning) {
        startTime = performance.now();
        pausedTime = 0;
        gameRunning = true;
        drawGarden();
      }
    }, { once: true });

    // Kick off
    resize();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
